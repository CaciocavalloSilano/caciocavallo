<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>

<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
<title>Caciocavallo Web Documentation</title>
</head>

<body>
	<h2>WebSurfaceData / Rendering:</h2>
One of the core components of caciocavallo-web is WebSurfaceData, an
implementation of OpenJDK's SurfaceData interface - which is basically
a surface Java2D can render to.<br>
Whenever a rendering operation is executed, Java2D's software rendering
implementation "locks" the target WebSurfaceData, and supplies
cacio-web the area it plans to modify, which are passed to the
GridDamageTracker.<p>

<h2>GridDamageTracker:</h2>
GridDamageTracker keeps a list of all modified areas of a
WebSurfaceData and groups those areas efficiently together, so that the
number of drawImage calls for the browser stays low but the amount of
wasted space caused by grouping stays low.<br>
<br>
This is archieved by splitting the SurfaceData's area into square cells (by default 16x16 pixels).<br>
- For small modified areas within such a square, a union rectangle is created:<br>
- Adjacent cells with the same union rectangle dimensions are merged, to further reduce the amount of cells.<br>
This pays off when e.g. drawing long lines or filling large rectangles.<br>
<br>
The following graphic illustrates the functionality of GridDamageTracker.<br>
The black lines illustrate the cell borders, green areas are areas
which are rendered to, and the read dashed reactangles are the areas
generated by GridDamageTracker's grouping algorithm.<br>
<p>
<div style="text-align: center;">
	<img alt="graphic illustrating GridDamageTrackers functionality" src="damage_tracker.png"><br>
</div>
<br>

<h2>TreeImagePacker:</h2>
TreeImagePacker packs the grouped areas it receives from GridDamageTracker
into a single image to improve compression and performance:
<p>
<div style="text-align: center;">
	<img alt="grouped areas after packing process" src="packer.png"><br>
</div>
<br>

<h2>Transports:</h2>
After the grouped areas have been packed into a single image, the image
is compressed by the transport. Furthermore the data which describes, 
which area of the packed image belongs where on the browser's canvas, 
is encoded and transported.
<p>
The following image shows the resulting image of the ImageTransport, which
stores its command-stream embedded in the image data.
The image has been generated for dragging a JSlider, which updates 
a JLabel's text. Without all those optimizations, the area to be transported
would have been 700x500px large, this one is 227x94 :)
<p>
<div style="text-align: center;">
	<img alt="packed real-world image" src="real_world_packed.png"><br>
</div>
<p>
Hint: to see the encoded command-information zoom the image, and look at
the image's first pixel row ;)

</body></html>
